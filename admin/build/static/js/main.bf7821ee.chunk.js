(this.webpackJsonpadmin=this.webpackJsonpadmin||[]).push([[0],{13:function(e,t){e.exports={translation:{admin:"Admin",account_current_password:"Current password",account_current_password_incorrect:"Current password is incorrect.",account_new_password:"New password",account_new_password_invalid:"New password is not valid.",account_password_instructions:"Passwords must be at least 8 characters long.",account_title:"Account",account_update_password_submit:"Update",account_update_password_success:"Your password was updated successfully.",account_update_password_title:"Update password",login_no_account_1:"Don't have an account? You can request access",login_no_account_2:"here",login_password:"Password",login_submit_button:"Sign in",login_title:"Please sign in",login_username:"Username",logout_button:"Sign out",menu_account:"Account",menu_checkpoints:"Checkpoints",menu_users:"Users",upload_fail:"Oops, that upload failed.",upload_instructions_1:"A COVID-19 positive patient can open the web app at",upload_instructions_2:'The patient should open the "Status" tab, and press "Download Checkpoints". This will download a file to the patient\'s phone, which the patient can email to you.',upload_instructions_3:"Once you have the file, you may upload it using the button below.",upload_success:"The checkpoints were uploaded successfully.",upload_title:"Upload Checkpoints",user_create_can_manage_users:"Can manage other users",user_create_credential_delivery:"Please provide these credentials to the user and instruct them to change their password once they log in.",user_create_exit:"Return to all users",user_create_fail:"Oops, there was an error creating this user.",user_create_invalid_username:"Only letters and numbers are allowed in a username.",user_create_submit:"Create",user_create_success:"A new user was created with the following credentials",user_create_title:"Create a new user",user_create_username:"Username",user_create_password:"Temporary password",user_delete_confirm:"Delete user",user_delete_fail:"Oops, something went wrong.",welcome:"Welcome"}}},17:function(e,t,a){e.exports=a(31)},22:function(e,t,a){},23:function(e,t,a){},25:function(e,t,a){},31:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(11),c=a.n(s),o=(a(22),a(23),a(9)),l=a(6),u=a(12),i=a(13),m={en:a.n(i).a};o.a.use(u.a).use(l.f).init({resources:m,fallbackLng:"en",keySeparator:!1,interpolation:{escapeValue:!1},detection:{order:["querystring","cookie","localStorage","navigator","htmlTag","path","subdomain"],lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupFromPathIndex:0,lookupFromSubdomainIndex:0,caches:["localStorage","cookie"],excludeCacheFor:["cimode"],cookieMinutes:10,cookieDomain:"myDomain",htmlTag:document.documentElement,checkWhitelist:!0}});o.a;var p=a(1),d=a.n(p),_=a(3),f=a(2),b=a(32),w=(a(25),function(){var e=Object(_.a)(d.a.mark((function e(t){var a,n,r,s=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=s.length>1&&void 0!==s[1]?s[1]:"GET",n=s.length>2?s[2]:void 0,e.next=4,fetch(t,{method:a,body:n?JSON.stringify(n):void 0,headers:{"Content-Type":"application/json"}});case 4:return r=e.sent,e.abrupt("return",r.json());case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());function h(e){var t=e.onLoginRequest,a=Object(n.useState)(""),s=Object(f.a)(a,2),c=s[0],o=s[1],l=Object(n.useState)(""),u=Object(f.a)(l,2),i=u[0],m=u[1],p=Object(b.a)().t,h=function(){var e=Object(_.a)(d.a.mark((function e(a){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.preventDefault(),e.next=3,w("/admin/login","POST",{username:c,password:i});case 3:n=e.sent,t(n&&n.isLoggedIn);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement("form",{class:"form-signin",onSubmit:h},r.a.createElement("h1",{class:"h3 mb-3 font-weight-normal"},p("login_title")),r.a.createElement("label",{for:"username",class:"sr-only"},p("login_username"),":"),r.a.createElement("br",null),r.a.createElement("input",{value:c,onChange:function(e){o(e.target.value)},type:"text",id:"username",name:"username",placeholder:p("login_username"),class:"form-control"}),r.a.createElement("br",null),r.a.createElement("label",{for:"password",class:"sr-only"},p("login_password"),":"),r.a.createElement("br",null),r.a.createElement("input",{value:i,onChange:function(e){m(e.target.value)},type:"password",id:"password",name:"password",placeholder:p("login_password"),class:"form-control"}),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("button",{class:"btn btn-lg btn-warning btn-block",type:"submit"},p("login_submit_button")),r.a.createElement("p",{class:"mt-5 mb-3 text-muted"},p("login_no_account_1")," ",r.a.createElement("a",{href:"https://forms.gle/J38BLRpFtRFT846Z8",target:"_blank",class:"text-warning"},p("login_no_account_2")),"."),r.a.createElement("p",{class:"mt-5 mb-3 text-muted"},"TrackCOVID"," ",p("admin")))}var g=function(e){try{JSON.parse(e)}catch(t){return!1}return!0};function v(e){e.onUpload;var t=Object(b.a)().t;return r.a.createElement("div",null,r.a.createElement("div",{class:"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom"},r.a.createElement("h1",{class:"h2"},t("upload_title"))),r.a.createElement("form",{id:"checkpoint-upload-form"},r.a.createElement("p",null,t("upload_instructions_1")," ","https://demo.trackcovid.net",". ",t("upload_instructions_2")),r.a.createElement("p",null,t("upload_instructions_3")),r.a.createElement("div",{class:"alert alert-success",style:{display:"none"},id:"upload-success",role:"alert"},t("upload_success")),r.a.createElement("input",{class:"btn btn-large btn-warning",type:"file",id:"checkpoint-upload",onChange:function(){var e=document.getElementById("checkpoint-upload").files;if(e.length<=0)return!1;var a=new FileReader;a.onload=function(){var e=Object(_.a)(d.a.mark((function e(a){var n,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a&&a.target.result&&g(a.target.result))){e.next=9;break}return n=JSON.parse(a.target.result),e.next=4,w("/admin/api/checkpoints","POST",{checkpoints:n});case 4:(r=e.sent)&&!r.error?alert(t("upload_success")):alert(t("upload_fail")),document.getElementById("checkpoint-upload-form").reset(),e.next=10;break;case 9:alert(t("upload_fail"));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.readAsText(e.item(0))}})))}var E={list:1,new:2};function k(e){var t=e.currentUser,a=Object(n.useState)(void 0),s=Object(f.a)(a,2),c=s[0],o=s[1],l=Object(n.useState)(E.list),u=Object(f.a)(l,2),i=u[0],m=u[1],p=Object(n.useState)(""),h=Object(f.a)(p,2),g=h[0],v=h[1],k=Object(n.useState)(!1),x=Object(f.a)(k,2),O=x[0],y=x[1],j=Object(n.useState)(""),S=Object(f.a)(j,2),C=S[0],T=S[1],D=Object(n.useState)(""),P=Object(f.a)(D,2),U=P[0],I=P[1],L=Object(b.a)().t,A=c||[],N=function(){var e=Object(_.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w("/admin/api/users");case 2:(t=e.sent)&&t.users&&o(t.users);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(n.useEffect)((function(){"undefined"===typeof c&&N()}));var F=function(){var e=Object(_.a)(d.a.mark((function e(t){var a,n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),!/((^[a-z]+)|(^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+[0-9a-z]+$/i.test(g)){e.next=12;break}return a=O?1:2,e.next=6,w("/admin/api/users","POST",{username:g,privilege:a});case 6:(n=e.sent).error?alert(L("user_create_fail")):(T(n.user.username),I(n.user.password),m(E.created),N()),v(""),y(!1),e.next=13;break;case 12:alert(L("user_create_invalid_username"));case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),J=function(){var e=Object(_.a)(d.a.mark((function e(t,a){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.confirm("".concat(L("user_delete_confirm"),": ").concat(a,"?"))){e.next=5;break}return e.next=3,w("/admin/api/users/".concat(t),"DELETE");case 3:(n=e.sent)&&!n.error?N():alert(L("user_delete_fail"));case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}();return r.a.createElement("div",null,r.a.createElement("div",{class:"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom"},r.a.createElement("h1",{class:"h2"},"Users")),i===E.list&&r.a.createElement("div",null,r.a.createElement("a",{class:"btn btn-dark text-light mb-2",onClick:function(){return m(E.new)}},"New user"),r.a.createElement("ul",{class:"list-group"},A.map((function(e){var a=1===e.privilege,n=e.id!==t.id;return r.a.createElement("li",{class:"list-group-item user-list"},r.a.createElement("strong",null,e.username),a&&r.a.createElement("span",null," (can manage users)"),n&&r.a.createElement("a",{onClick:function(){return J(e.id,e.username)},class:"btn btn-danger text-light user-delete"},"Delete"))})))),i===E.new&&r.a.createElement("form",{class:"form-signin",onSubmit:F},r.a.createElement("h2",{class:"h3 mb-3 font-weight-normal"},L("user_create_title")),r.a.createElement("label",{for:"username",class:"sr-only"},L("user_create_username"),":"),r.a.createElement("input",{value:g,onChange:function(e){v(e.target.value)},type:"text",id:"username",name:"username",placeholder:L("user_create_username"),class:"form-control"}),r.a.createElement("div",{class:"form-check"},r.a.createElement("input",{checked:O,onChange:function(){y(!O)},class:"form-check-input",type:"checkbox",id:"can-manage"}),r.a.createElement("label",{class:"form-check-label",for:"can-manage"},L("user_create_can_manage_users"))),r.a.createElement("button",{class:"btn btn-lg btn-warning btn-block mt-3",type:"submit"},L("user_create_submit"))),i===E.created&&r.a.createElement("div",null,r.a.createElement("h2",{class:"h3 mb-3 font-weight-normal"},L("user_create_success"),":"),r.a.createElement("p",null,L("user_create_username"),": ",r.a.createElement("strong",null,C)),r.a.createElement("p",null,L("user_create_password"),": ",r.a.createElement("strong",null,U)),r.a.createElement("p",null,L("user_create_credential_delivery")),r.a.createElement("a",{class:"btn btn-dark text-light mt-2",onClick:function(){return m(E.list)}},L("user_create_exit"))))}function x(){var e=Object(n.useState)(""),t=Object(f.a)(e,2),a=t[0],s=t[1],c=Object(n.useState)(""),o=Object(f.a)(c,2),l=o[0],u=o[1],i=Object(b.a)().t,m=function(){var e=Object(_.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),!/^[\w!@#$%^&*]{8,}$/.test(l)){e.next=9;break}return e.next=5,w("/admin/api/account","PUT",{currentPassword:a,newPassword:l});case 5:e.sent.error?alert(i("account_current_password_incorrect")):(alert(i("account_update_password_success")),s(""),u("")),e.next=10;break;case 9:alert(i("account_new_password_invalid"));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement("div",null,r.a.createElement("div",{class:"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-left pt-3 pb-2 mb-3 border-bottom"},r.a.createElement("h1",{class:"h2"},i("account_title"))),r.a.createElement("form",{class:"form-signin",onSubmit:m},r.a.createElement("h2",{class:"h3 mb-3 font-weight-normal"},i("account_update_password_title")),r.a.createElement("p",null,i("account_password_instructions")),r.a.createElement("label",{for:"current-password",class:"sr-only"},i("account_current_password"),":"),r.a.createElement("input",{value:a,onChange:function(e){s(e.target.value)},type:"password",id:"username",name:"current-password",placeholder:i("account_current_password"),class:"form-control"}),r.a.createElement("label",{for:"new-password",class:"sr-only"},i("account_new_password"),":"),r.a.createElement("input",{value:l,onChange:function(e){u(e.target.value)},type:"password",id:"username",name:"new-password",placeholder:i("account_new_password"),class:"form-control"}),r.a.createElement("button",{class:"btn btn-lg btn-warning btn-block mt-3",type:"submit"},i("account_update_password_submit"))))}var O=1,y=2,j=3;var S=function(){var e=Object(n.useState)(void 0),t=Object(f.a)(e,2),a=t[0],s=t[1],c=Object(n.useState)({}),o=Object(f.a)(c,2),l=o[0],u=o[1],i=Object(n.useState)(O),m=Object(f.a)(i,2),p=m[0],g=m[1],E=Object(b.a)().t,S=l&&1===l.privilege,C=function(){var e=Object(_.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w("/admin/api/status");case 2:(t=e.sent)&&(s(t.isLoggedIn),u(t.user));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(n.useEffect)((function(){"undefined"===typeof a&&C()}));var T=function(){var e=Object(_.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t?C():alert("Login failed");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return a?r.a.createElement("div",{className:"App"},r.a.createElement("nav",{class:"navbar navbar-dark fixed-top bg-dark flex-md-nowrap p-0 shadow"},r.a.createElement("a",{class:"navbar-brand col-sm-3 col-md-2 mr-0",href:"/admin"},"TrackCOVID"," ",E("admin")),r.a.createElement("ul",{class:"navbar-nav px-3"},r.a.createElement("li",{class:"nav-item text-nowrap"},r.a.createElement("a",{class:"nav-link",href:"/admin/logout"},E("logout_button"))))),r.a.createElement("div",{class:"container-fluid"},r.a.createElement("div",{class:"row"},r.a.createElement("nav",{class:"col-md-2 d-none d-md-block bg-light sidebar"},r.a.createElement("div",{class:"sidebar-sticky"},r.a.createElement("ul",{class:"nav flex-column"},r.a.createElement("li",{class:"nav-item"},r.a.createElement("a",{class:"nav-link",onClick:function(){return g(O)}},E("menu_checkpoints"))),S&&r.a.createElement("li",{class:"nav-item"},r.a.createElement("a",{class:"nav-link",onClick:function(){return g(y)}},E("menu_users"))),r.a.createElement("li",{class:"nav-item"},r.a.createElement("a",{class:"nav-link",onClick:function(){return g(j)}},E("menu_account")))))),r.a.createElement("main",{role:"main",class:"col-md-9 ml-sm-auto col-lg-10 px-4"},r.a.createElement("p",{class:"mt-3"},E("welcome"),", ",l.username,"."),p===O&&r.a.createElement(v,null),S&&p===y&&r.a.createElement(k,{currentUser:l}),p===j&&r.a.createElement(x,null))))):r.a.createElement("div",{class:"login-container bg-dark text-center text-light"},r.a.createElement(h,{onLoginRequest:T}))};c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(S,null)),document.getElementById("root"))}},[[17,1,2]]]);
//# sourceMappingURL=main.bf7821ee.chunk.js.map